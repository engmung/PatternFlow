# Patternflow 2.0 Refactor Plan

## 1. Overview
This document outlines the architectural changes required to transform Patternflow into a **Curated Generative Art Platform**.
- **Studio (Curator Mode)**: A professional tool for artists to design node-based patterns, visualize parameter variations in a 5x5 grid, and export "Curated Presets".
- **Landing (Experience Mode)**: A lightweight, preset-based experience where users explore artist-curated patterns with simplified, meaningful controls.

---

## 2. Core Architecture Changes

### 2.1 Separation of Concerns
Currently, `Scene.tsx` mixes rendering logic with studio state. We will extract the core logic into a reusable **PatternEngine**.

-   **`src/engine/PatternEngine.ts`**: Parameters -> Nodes -> Fragment Shader (Pure Function)
-   **`src/engine/Renderer.tsx`**: React Component that takes a `shader` and renders it (Shared by Studio & Landing).

### 2.2 Data Schema: The "Curated Preset"
We will introduce a standard JSON format that bridges the Studio and the Landing page.

```typescript
// src/types/Preset.ts

export interface CuratedParameter {
  id: string;          // e.g., "complexity"
  label: string;       // Display name: "Complexity"
  nodeId: string;      // Target node ID
  property: string;    // Target property (e.g., "scale", "distortion")
  min: number;
  max: number;
  default: number;
  step: number;        // Slider step
}

export interface CuratedPreset {
  id: string;
  name: string;
  description: string;
  author: string;
  version: number;
  
  // The DNA
  nodes: Node[];
  connections: Connection[];
  colorRamp: ColorRampStop[];
  
  // The Interface
  parameters: CuratedParameter[]; // Max 2 parameters
  
  // Metadata
  thumbnail?: string; // Base64 or path
}
```

---

## 3. Studio Refactor: Curator Mode

### 3.1 5x5 Grid Visualization (The "Digging" Interface)
Instead of a single viewport, the Studio will feature a "Curator View".

-   **Concept**:
    *   **Center Cell (1,1)**: The Master Pattern (Current Node Graph).
    *   **Surrounding Cells**: Variations generated by spreading value of 2 selected parameters.
    *   **X-Axis**: Spreads Parameter A (e.g., -50% to +50% of range).
    *   **Y-Axis**: Spreads Parameter B.

-   **Interaction**:
    *   **Select**: Clicking a surrounding cell makes it the new Center (Master).
    *   **Spread Control**: A simplified "Spread Factor" slider to control how different the variations are.

### 3.2 Parameter curation UI
-   A new panel in Studio to "Tag" specific Node inputs as "Public Parameters".
-   Limit to 2 active parameters for the 5x5 grid logic.

---

## 4. Landing Page Refactor

### 4.1 Preset-Based Architecture
The Landing page will no longer use a hardcoded `InteractiveStudio`. It will load presets from `public/presets/`.

-   **`src/components/PatternExperience.tsx`**:
    *   Loads a `CuratedPreset` JSON.
    *   Renders the `Renderer` component.
    *   Generates UI sliders dynamically based on `preset.parameters`.
    
### 4.2 Performance Optimization (Lazy Loading)
-   The heavy `three.js` and shader generation logic will be chunked.
-   The Landing Page initial load will only fetch the UI and a static thumbnail.
-   The 3D Engine initializes only when the user interacts or scrolls into view.

---

## 5. Development Roadmap

### Phase 1: Engine Extraction & Data Schema
- [ ] Define `CuratedPreset` types in `src/types/Preset.ts`.
- [ ] Refactor `Scene.tsx` to separate shader generation logic into `src/engine/PatternEngine.ts`.
- [ ] Ensure `NodeEditor` and `Scene` still work with the refactored engine.

### Phase 2: Curator Mode (Studio)
- [ ] Create `CuratorPanel.tsx`: Interface to select 2 parameters and define ranges.
- [ ] Implement `GridPreview.tsx`: The 5x5 grid renderer.
    *   *Optimization*: Use a single WebGLRenderer with `scissor` rectangles for 25 views to maintain 60fps.
- [ ] Implement `Export Preset` button (JSON download).

### Phase 3: Landing Page Implementation
- [ ] Create `public/presets/` and add 3 initial curated presets.
- [ ] Build `PatternExperience.tsx`: The consumer component.
- [ ] Replace the current "Interactive Studio" section in `App.tsx` with `<PatternExperience />`.
- [ ] Add "Preset Gallery" UI to switch between patterns.

### Phase 4: Polish
- [ ] Add "Resolution" toggle (Low/High) in Landing.
- [ ] Verify Mobile/Desktop responsiveness.
- [ ] SEO & Metadata updates.
